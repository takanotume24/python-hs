# AGENTS

## 目的
このリポジトリは、TDD（テスト駆動開発）を用いて Haskell で Python インタプリタを実装することを目的としています。

## 必須ワークフロー
1. まず失敗するテストを書き、または既存のテストを更新する。
2. テストが通るために必要最小限の実装を行う。
3. テストがグリーンのままリファクタリングを行う。
4. 小さなステップで繰り返す。
5. マイルストーンの開始、スコープ変更、または完了があったら必ず `plans.md` を更新する。
6. コミットする前に必ず `cabal test` を実行し、すべてのテストが通っていることを確認する。
7. ビルド／テストでコンパイラ警告（`warning`）が出た場合は必ず修正し、警告が 0 の状態でコミットする。

注意: このファイルには「方針・手順・指示」のみを記載し、実装計画は必ず `plans.md` に記載すること。

## ファイル粒度ルール
- `.hs` ファイルごとにトップレベル関数は1つにする。
- `.hs` ファイルごとに型定義（`data`、`newtype`、`typeclass`）は1つにする。
- モジュールは小さく、合成しやすく保つ。
- 行数上限違反（`check-structure`）を解消する際、空行削除での調整は禁止。責務ごとに別ファイルへ分離して解消すること。

## 命名規則
- 関数: `camelCase`
- 型およびコンストラクタ: `PascalCase`
- テストモジュール: `<FunctionName>Spec` または `<Feature>Spec`
- ファイル名は、そのファイルに定義される主要なトップレベル関数または型／クラス名と一致させる（ファイル名は PascalCase を使用）。例: 関数 `fooBar` → `FooBar.hs`; 型／クラス `MyType` → `MyType.hs`。（日本語: ファイル名はトップレベルの関数名／クラス名と一致させること。例: 関数 `fooBar` → `FooBar.hs`、型 `MyType` → `MyType.hs`。）

## テスト
- 実行可能な仕様には `hspec` を使用する。
- テストは決定論的で焦点を絞ったものにする。
- ランタイム機能を拡張する前に、言語の振る舞いに対する受け入れテストを追加する。
- TDD の例（2026-02-17）：評価器用の失敗するユニットテストを追加（`EvalSpec`）、その後 `PythonHS.Evaluator.evalProgram` を実装してテストを通した — リポジトリにコミット済み。

## 品質ゲート
- `cabal test` が成功すること。
- `cabal run check-structure` が成功すること。
- コンパイルに警告がないこと（警告が出たら修正してからコミットすること）
